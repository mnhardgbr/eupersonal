<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Conex√£o Completo</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        .loading { background-color: #fff3cd; border-color: #ffeaa7; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üîç Teste de Conex√£o Completo - Eu Personal</h1>
    
    <div class="test-section info">
        <h3>üìã Informa√ß√µes do Projeto</h3>
        <p><strong>URL:</strong> https://bntdzvjyemwvpzttptwu.supabase.co</p>
        <p><strong>Status:</strong> <span id="project-status">Verificando...</span></p>
    </div>

    <div class="test-section loading">
        <h3>üåê Teste de Conectividade</h3>
        <div id="connectivity-test">Testando conectividade...</div>
    </div>

    <div class="test-section loading">
        <h3>üîê Teste de Autentica√ß√£o</h3>
        <div id="auth-test">Testando autentica√ß√£o...</div>
    </div>

    <div class="test-section loading">
        <h3>üìä Teste de Banco de Dados</h3>
        <div id="database-test">Testando banco de dados...</div>
    </div>

    <div class="test-section loading">
        <h3>üìù Teste de Tabela Alunos</h3>
        <div id="table-test">Testando tabela alunos...</div>
    </div>

    <div class="test-section">
        <h3>üìä Log de Resultados</h3>
        <div id="log"></div>
    </div>

    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'
        
        const supabase = createClient(
            'https://bntdzvjyemwvpzttptwu.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJudGR6dmp5ZW13dnB6dHRwdHd1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkxMjc3MTEsImV4cCI6MjA2NDcwMzcxMX0.TR-UU4J7AxWOHGLvBf16oQSU_TIkzQ8P536av0-Za0g'
        );

        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<strong>[${timestamp}]</strong> ${message}`;
            logEntry.className = type;
            logDiv.appendChild(logEntry);
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        function updateSection(id, content, className = 'info') {
            const element = document.getElementById(id);
            element.innerHTML = content;
            element.parentElement.className = `test-section ${className}`;
        }

        async function runTests() {
            log('üöÄ Iniciando testes de conectividade...');

            // Teste 1: Conectividade b√°sica
            try {
                log('Testando conectividade b√°sica...');
                updateSection('connectivity-test', 'Testando...', 'loading');
                
                // Teste simples de ping
                const startTime = Date.now();
                const { data, error } = await supabase.from('alunos').select('count').limit(1);
                const endTime = Date.now();
                const responseTime = endTime - startTime;
                
                if (error) {
                    if (error.message.includes('relation') || error.message.includes('does not exist')) {
                        updateSection('connectivity-test', 
                            `‚úÖ Conectividade OK (${responseTime}ms)<br>‚ö†Ô∏è Tabela 'alunos' n√£o existe`, 'success');
                        log('‚úÖ Conectividade funcionando, mas tabela n√£o existe', 'success');
                    } else {
                        updateSection('connectivity-test', 
                            `‚ùå Erro de conectividade: ${error.message}`, 'error');
                        log(`‚ùå Erro de conectividade: ${error.message}`, 'error');
                    }
                } else {
                    updateSection('connectivity-test', 
                        `‚úÖ Conectividade OK (${responseTime}ms)`, 'success');
                    log('‚úÖ Conectividade funcionando perfeitamente', 'success');
                }
            } catch (err) {
                updateSection('connectivity-test', 
                    `‚ùå Erro de rede: ${err.message}`, 'error');
                log(`‚ùå Erro de rede: ${err.message}`, 'error');
            }

            // Teste 2: Autentica√ß√£o
            try {
                log('Testando autentica√ß√£o...');
                updateSection('auth-test', 'Testando...', 'loading');
                
                const { data: { session }, error } = await supabase.auth.getSession();
                
                if (error) {
                    updateSection('auth-test', 
                        `‚ùå Erro de autentica√ß√£o: ${error.message}`, 'error');
                    log(`‚ùå Erro de autentica√ß√£o: ${error.message}`, 'error');
                } else {
                    updateSection('auth-test', 
                        `‚úÖ Autentica√ß√£o OK<br>Session: ${session ? 'Ativa' : 'Nenhuma'}`, 'success');
                    log('‚úÖ Autentica√ß√£o funcionando', 'success');
                }
            } catch (err) {
                updateSection('auth-test', 
                    `‚ùå Erro na autentica√ß√£o: ${err.message}`, 'error');
                log(`‚ùå Erro na autentica√ß√£o: ${err.message}`, 'error');
            }

            // Teste 3: Banco de dados
            try {
                log('Testando acesso ao banco...');
                updateSection('database-test', 'Testando...', 'loading');
                
                // Tentar listar todas as tabelas
                const { data: tables, error } = await supabase
                    .from('information_schema.tables')
                    .select('table_name')
                    .eq('table_schema', 'public')
                    .limit(10);
                
                if (error) {
                    updateSection('database-test', 
                        `‚ùå Erro ao acessar banco: ${error.message}`, 'error');
                    log(`‚ùå Erro ao acessar banco: ${error.message}`, 'error');
                } else {
                    const tableNames = tables.map(t => t.table_name).join(', ');
                    updateSection('database-test', 
                        `‚úÖ Banco acess√≠vel<br>Tabelas: ${tableNames || 'Nenhuma'}`, 'success');
                    log(`‚úÖ Banco acess√≠vel. Tabelas: ${tableNames || 'Nenhuma'}`, 'success');
                }
            } catch (err) {
                updateSection('database-test', 
                    `‚ùå Erro no banco: ${err.message}`, 'error');
                log(`‚ùå Erro no banco: ${err.message}`, 'error');
            }

            // Teste 4: Tabela alunos
            try {
                log('Testando tabela alunos...');
                updateSection('table-test', 'Testando...', 'loading');
                
                const { data, error } = await supabase
                    .from('alunos')
                    .select('*')
                    .limit(1);
                
                if (error) {
                    if (error.message.includes('relation') || error.message.includes('does not exist')) {
                        updateSection('table-test', 
                            `‚ö†Ô∏è Tabela 'alunos' n√£o existe<br>üí° Execute o script SQL no Supabase`, 'error');
                        log('‚ö†Ô∏è Tabela alunos n√£o existe - precisa ser criada', 'error');
                    } else {
                        updateSection('table-test', 
                            `‚ùå Erro na tabela: ${error.message}`, 'error');
                        log(`‚ùå Erro na tabela: ${error.message}`, 'error');
                    }
                } else {
                    updateSection('table-test', 
                        `‚úÖ Tabela alunos OK<br>Registros: ${data.length}`, 'success');
                    log(`‚úÖ Tabela alunos funcionando. Registros: ${data.length}`, 'success');
                }
            } catch (err) {
                updateSection('table-test', 
                    `‚ùå Erro ao testar tabela: ${err.message}`, 'error');
                log(`‚ùå Erro ao testar tabela: ${err.message}`, 'error');
            }

            // Atualizar status do projeto
            const hasErrors = document.querySelectorAll('.error').length > 0;
            const hasWarnings = document.querySelectorAll('.warning').length > 0;
            
            if (hasErrors) {
                updateSection('project-status', '‚ùå Problemas detectados', 'error');
            } else if (hasWarnings) {
                updateSection('project-status', '‚ö†Ô∏è Funcionando com avisos', 'warning');
            } else {
                updateSection('project-status', '‚úÖ Funcionando perfeitamente', 'success');
            }

            log('üèÅ Testes conclu√≠dos!', 'success');
        }

        // Executar testes quando a p√°gina carregar
        window.addEventListener('load', runTests);
    </script>
</body>
</html>
